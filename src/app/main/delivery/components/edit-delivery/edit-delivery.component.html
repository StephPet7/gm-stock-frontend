<mat-card>
    <div class="row">
    <div class="offset-1 col-10">

      <div class="row justify-content-center">
        <div class="col-12 col-sm-5">
          <button class="button_margin_top" type="button" mat-raised-button color="primary" (click)="addCommands()">
            <mat-icon>add</mat-icon>
            <span>Livrer une commande</span>
          </button>
        </div>
      </div>

      <div class="row justify-content-center">
        <div class="col-12" [formArray]="commands" *ngFor="let commandGroup of getCommandsFormGroup(); let i = index">
          <mat-card>
            <div [formGroup]="commandGroup" class="col-12 justify-content-center align-items-center">
              <div class="row justify-content-center">
                <div class="col-10 offset-1 col-sm-7">
                  <mat-form-field appearance="standard" class="input_field_width_control">
                    <mat-label>Commande: </mat-label>
                    <mat-select formControlName="command">
                      <mat-option *ngFor="let c of commandToSelect"
                                  [value]="c.id"
                                  (click)="onCommandSelection(c.id, i)">
                        {{c.title}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                  <p *ngIf="commandGroup.get('selected')!.value">Commande déjà sélectionnée</p>
                </div>
              </div>

              <div *ngIf="commandGroup.get('command')!.value&&!commandGroup.get('selected')!.value" class="row justify-content-center">
                <div class="col-12">
                  <div class="mat-elevation-z8">
                    <table mat-table [dataSource]="commandGroup.get('commandRows')!.value" aria-describedby="List of commands">

                      <!-- Product Column -->
                      <ng-container matColumnDef="product">
                        <th mat-header-cell id="product" *matHeaderCellDef> Produit </th>
                        <td mat-cell *matCellDef="let element"> {{element.product.name}} </td>
                      </ng-container>

                      <!-- Quantity Column -->
                      <ng-container matColumnDef="quantityOrdered">
                        <th mat-header-cell id="quantityOrdered" *matHeaderCellDef> Quantité Commandée </th>
                        <td mat-cell *matCellDef="let element"> {{element.quantityOrdered}} </td>
                      </ng-container>

                      <!-- Remaining Column -->
                      <ng-container matColumnDef="remaining">
                        <th mat-header-cell id="remaining" *matHeaderCellDef> Reste à Livrer </th>
                        <td mat-cell *matCellDef="let element"> {{element.remaining}} </td>
                      </ng-container>

                      <!-- Delivered Column -->
                      <ng-container matColumnDef="action">
                        <th mat-header-cell id="action" *matHeaderCellDef> Livrer </th>
                        <td mat-cell *matCellDef="let element">
                          <button mat-raised-button
                                  class="icon-button mr-2"
                                  color="primary"
                                  (click)="onEditQuantityToDeliver(i, element)">
                            <mat-icon>edit</mat-icon>
                          </button>
                        </td>
                      </ng-container>

                      <tr mat-header-row *matHeaderRowDef="['product', 'quantityOrdered', 'remaining', 'action']"></tr>
                      <tr class="detailed-row" mat-row *matRowDef="let rowele; columns: ['product', 'quantityOrdered', 'remaining', 'action']"></tr>
                    </table>
                    <mat-paginator [pageSizeOptions]="[5, 10, 15]"></mat-paginator>
                  </div>
                </div>
              </div>

              <div class="row pt-4">
                <div class="col-12 text-right">
                  <button mat-raised-button
                          color="warn"
                          type="button"
                          class="button_margin_top mr-2"
                          (click)="removeCommands(commandGroup.get('command')!.value, i)">
                    <span>Annuler la livraison de la commande</span>
                  </button>
                </div>
              </div>
            </div>
          </mat-card>
        </div>
      </div>

      <div class="row pt-4">
        <div class="col-sm-12 col-12 text-sm-right">
          <button mat-raised-button color="accent" type="reset"
                  class="button_margin_top mr-sm-2 mr-1">Reset</button>
          <button mat-raised-button color="warn" type="button"
                  class="button_margin_top mr-sm-2 mr-1" (click)="onCancel()">Annuler</button>
          <button mat-raised-button color="primary" type="button"
                  class="button_margin_top" [disabled]="commands.invalid||commands.length===0" (click)="onSubmit()">Enregistrer</button>
        </div>
      </div>
    </div>
  </div>
</mat-card>
